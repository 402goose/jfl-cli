{"v":1,"ts":"2026-02-09T23:30:00.000Z","session":"main","type":"feature","status":"complete","title":"Fixed JFL CLI namespace violations - MCP config, Conf replacement, code directory","summary":"Stopped JFL from modifying files outside ~/.jfl/ namespace. Fixed 3 critical violations: .mcp.json (Claude Code's config), Conf library storage (OS-specific dirs), and hardcoded ~/code/formation clone location.","detail":"Created src/utils/jfl-config.ts utility to centralize all config in ~/.jfl/config.json. Updated service-agent.ts to write MCP config to project-local .mcp.json (if in project) or ~/.jfl/mcp-config.json (otherwise). Replaced all Conf library usage (5 files) with new utility. Added getCodeDirectory() that prompts user on first use and stores preference. Updated onboard.ts and init.ts to use user's code directory instead of hardcoded ~/code/formation.","files":["src/utils/jfl-config.ts","src/commands/service-agent.ts","src/commands/profile.ts","src/commands/login.ts","src/utils/auth-guard.ts","src/utils/ensure-project.ts","src/index.ts","src/commands/onboard.ts","src/commands/init.ts"],"next":"Add migration command for existing users, add verification tests","learned":["Smart MCP config detection: project-local if in project, JFL namespace otherwise","User preference prompting pattern: ask once, store, reuse","Breaking other tools' configs is a critical violation"]}
{"v":1,"ts":"2026-02-09T18:00:00.000Z","session":"$(git branch --show-current)","type":"feature","status":"complete","title":"XDG Base Directory Migration Implementation","summary":"Implemented full XDG Base Directory migration to move ~/.jfl/ to XDG-compliant paths with auto-migration","detail":"Implemented comprehensive XDG Base Directory migration:\n\n1. Created centralized path utility (src/utils/jfl-paths.ts):\n   - JFL_PATHS for config/data/cache directories\n   - JFL_FILES for specific file paths\n   - Cross-platform support (Linux/macOS/Windows)\n   - Migration detection functions\n\n2. Created auto-migration logic (src/utils/jfl-migration.ts):\n   - Automatic migration on first run\n   - Safe copy-then-delete approach\n   - Error handling and rollback\n   - Silent mode for background migration\n\n3. Updated ALL references (~140+ locations):\n   - CLI entry point (src/index.ts) - migration check at startup\n   - Core utils: jfl-config.ts\n   - Commands: update.ts, service-agent.ts, voice.ts, services.ts, service-manager.ts, context-hub.ts, orchestrate.ts, services-scan.ts\n   - UI components: services-manager.tsx, service-dashboard.ts\n   - MCP servers: service-mcp-server.ts\n   - Lib: service-dependencies.ts\n   - Tests: session-namespace.test.ts\n\n4. XDG Directory Structure:\n   - Config: ~/.config/jfl/ (config.json, auth.json, voice.yaml)\n   - Data: ~/.local/share/jfl/ (sessions.json, services/, models/)\n   - Cache: ~/.cache/jfl/ (last-update-check)\n\n5. Migration Safety:\n   - Auto-detects legacy ~/.jfl/\n   - Copies files to new locations\n   - Validates migration success\n   - Only deletes legacy dir if successful\n\n6. All tests pass (43/43):\n   - Updated session namespace tests\n   - All XDG path assertions pass\n   - Build succeeds without errors\n\nProject-local .jfl/ directories remain unchanged. This fixes the root cause of the ~/CLAUDE.md overwrite bug by preventing JFL from creating files in the home directory root.","files":["src/utils/jfl-paths.ts","src/utils/jfl-migration.ts","src/index.ts","src/utils/jfl-config.ts","src/commands/update.ts","src/commands/service-agent.ts","src/commands/voice.ts","src/commands/services.ts","src/commands/service-manager.ts","src/commands/context-hub.ts","src/commands/orchestrate.ts","src/commands/services-scan.ts","src/ui/services-manager.tsx","src/ui/service-dashboard.ts","src/mcp/service-mcp-server.ts","src/lib/service-dependencies.ts","src/utils/__tests__/session-namespace.test.ts"],"next":"Test migration in real environment, update documentation"}
